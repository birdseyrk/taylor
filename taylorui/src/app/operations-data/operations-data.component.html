

<p-panel header="{{myReportHeader}} - Operations Data">
       
    <p-button id="manual-load"  label="Load Data"           icon="pi pi-external-link"                                                                             [text]="true" [rounded]="true" severity="info"   [outlined]="true" (click)="showDataDialog()"></p-button>
    <p-button id="file"         label="File Import"         icon="pi pi-file-o"                                                                                    [text]="true" [rounded]="true" severity="info"   [outlined]="true" (click)="showImportFileDialog()"></p-button>
    <p-button id="edit"         label="edit"                icon="pi pi-user-edit"                                  [disabled]="operationMonthlyData.length === 0" [text]="true" [rounded]="true" severity="info"   [outlined]="true" (click)="showEditDialog()"></p-button>
    <p-button id="chart"        label="Elevation Graph"     icon="pi pi-chart-line"                                 [disabled]="operationMonthlyData.length === 0" [text]="true" [rounded]="true" severity="info"   [outlined]="true" (click)="showElevationDialog()"></p-button>
    <p-button id="month"        label="Monthly"             icon="pi pi-calendar-plus"                              [disabled]="operationMonthlyData.length === 0" [text]="true" [rounded]="true" severity="info"   [outlined]="true" (click)="showMonthlyDialog()"></p-button>
    <p-button id="calendar"     label="Calendar"            icon="pi pi-calendar"                                                                                  [text]="true" [rounded]="true" severity="info"   [outlined]="true" (click)="showCalendarDialog()"></p-button>
    
    <p-button id="links"         label="Links"              icon="pi pi-link"                                                                                      [text]="true" [rounded]="true" severity="info"   [outlined]="true" (click)="linksVisible = true"></p-button>
    
    <p-button id="save"         label="Save"                icon="pi pi-save"                                       [disabled]="operationMonthlyData.length === 0" [text]="true" [rounded]="true" severity="info"   [outlined]="true" (click)="showSaveDataDialog()"></p-button>
    <p-button id="clear"        label="Clear Data"          icon="pi pi-times-circle"   [style]="{'float':'right'}" [disabled]="operationMonthlyData.length === 0" [text]="true" [rounded]="true" severity="danger" [outlined]="true" (click)="showClearOperationalDataDialog()"></p-button>
    <p-button id="refresh"      label="Clear Manual Inputs" icon="pi pi-refresh"     [style]="{'float':'right'}" [disabled]="operationMonthlyData.length === 0" [text]="true" [rounded]="true" severity="danger" [outlined]="true" (click)="clearManualInputs()"></p-button>
    <!-- <p-button id="help"         label="Help"                icon="pi pi-briefcase"      [style]="{'float':'right'}"                                   [text]="true" [rounded]="true" severity="info"   [outlined]="true" (click)="operationsHelpSidebarVisible=true"></p-button> -->
    <p-button id="help"         label="Help"                icon="pi pi-briefcase"      [style]="{'float':'right'}"                                   [text]="true" [rounded]="true" severity="info"   [outlined]="true" (click)="openPDF('./assets/help/Load-Data.pdf')"></p-button>
    <p-button id="stipulation"  label="Amended Stipulation" icon="pi pi-briefcase"      [style]="{'float':'right'}"                                   [text]="true" [rounded]="true" severity="success"   [outlined]="true" (click)="openPDF('./assets/help/Amended-Stipulation.pdf')"></p-button>

<p-divider></p-divider>
    <span >{{eomContentLabel}}</span>
    <span ><b>   April-July inflow  </b></span>
    <span [ngStyle]="{background:yearTypeBackground}"><b>{{yearTypeInflow}}</b></span>
    <span [ngStyle]="{background:yearTypeBackground}"><b>{{yearTypeLabel}}</b></span>

    <p-table [scrollable]="true" scrollHeight="900px" [styleClass]="selectedSize" [value]="operationMonthlyData" [tableStyle]="{ 'min-width': '120rem' }" [autoLayout]="true">
        <ng-template pTemplate="header">
            <tr padding="3px">
                <th width="15px" class="text-left">Month</th>
                <th width="5px"  class="text-center">Days</th>
                <th width="10px"  class="text-center">Manual<br>Inflow<br>(AF)</th>
                <th width="5px"  class="text-center">Predicted<br>Inflow<br>(AF)</th>
                <th width="5px"  class="text-center">Inflow<br>(CF)</th>
                <th width="5px"  class="text-center">Manual<br>Outflow<br>(AF)</th>
                <th width="5px"  class="text-center">Outflow<br>(AF)</th>
                <th width="5px"  class="text-center">Outflow<br>(CF)</th>
                <th width="5px"  class="text-center">Average<br>Inflow<br>(CFS)</th>
                <th width="5px"  class="text-center">Average<br>Outflow<br>(CFS)</th>
                <th width="5px"  class="text-center">EOM<br>Content<br>(AF)</th>
                <th width="5px"  class="text-center">EOM<br>Elevation<br>(FT)</th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-myData >  
               
                <tr padding="3px">
                                        
                    <td width="15px" class="text-left p-inputtext-sm">{{ myData.month + ' ' +  myData.dateRange }}</td>  
                    <td width="5px"  class="text-center"  >{{myData.days}}</td>
                    <td width="5px"  class="text-center p-inputtext-sm" [ngStyle]="{'background':myData.manualInFlowColor}">{{myData.manualInflow}}</td>
                    
                    <td width="5px" class="text-center p-inputtext-sm">{{myData.inflow}}</td>
                    <td width="5px" class="text-center p-inputtext-sm">{{myData.inflowCF}}</td>
                    <td width="5px" class="text-center p-inputtext-sm" [ngStyle]="{'background':myData.manualOutFlowColor}">{{myData.manualOutflow}}</td>
                    
                    <td width="5px" class="text-center p-inputtext-sm">{{myData.outflow}}</td>
                    <td width="5px" class="text-center p-inputtext-sm">{{myData.outflowCF}}</td>
                    <td width="5px" class="text-center p-inputtext-sm">{{myData.avgInflowCFS.toFixed(2)}}</td>
                    <td width="5px" class="text-center p-inputtext-sm">{{myData.avgOutflowCFS.toFixed(2)}}</td>
                    <td width="5px" class="text-center p-inputtext-sm">{{myData.eomContent.toFixed(2)}}</td>
                    <td width="5px" class="text-center p-inputtext-sm"  [ngStyle]="{'background':myData.elevationWarning}" >{{myData.eomElevation.toFixed(2)}}</td>
                </tr>
            </ng-template>
    </p-table>

    <div class="card flex justify-content-center">
        <p-sidebar [(visible)]="operationsHelpSidebarVisible">
            <h3>Operations</h3>
            <p>
                ToDo Operations Help.
            </p>
        </p-sidebar>
    </div>

    <div class="card flex justify-content-center">
        <p-sidebar [(visible)]="editHelpSidebarVisible">
            <h3>Edit Data</h3>
            <p>
                ToDo Edit Data Help.
            </p>
        </p-sidebar>
    </div>

    <div class="card flex justify-content-center">
        <p-sidebar [(visible)]="loadDataHelpSidebarVisible">
            <h3>Load Data</h3>
            <p>
                ToDo Load Data Help.
            </p>
        </p-sidebar>
    </div>

    <div class="card flex justify-content-center">
        <p-sidebar [(visible)]="fileImportHelpSidebarVisible">
            <h3>Import Saved Report</h3>
            <p>
                ToDo Import Saved Report Help.
            </p>
        </p-sidebar>
    </div>

    <div class="card flex justify-content-center">
        <p-sidebar [(visible)]="saveDataHelpSidebarVisible">
            <h3>Save Report</h3>
            <p>
                ToDo Save Report Help.
            </p>
        </p-sidebar>
    </div>

    <p-dialog header="Operations Data" [(visible)]="dataDialogVisible" [style]="{width: '32vw'}" [modal]="false" [draggable]="false" [resizable]="false">

        <textarea rows="30" cols="75" pInputTextarea [(ngModel)]="proposedOperations"></textarea>
        <p-divider></p-divider>
        <p-button
            [disabled]="proposedOperations.length === 0 "
            label="Load Proposed Operations"
            (click)="processData($event)"
        ></p-button>
        <p-button
            [style]="{'float':'right'}"
            [disabled]="proposedOperations.length === 0 "
            label="Clear Proposed Operations"
            (click)="clearData($event)"
        ></p-button>
        <p-button id="help"         label="Help"              icon="pi pi-briefcase"      [style]="{'float':'right'}"                                   [text]="true" [rounded]="true" severity="info"   [outlined]="true" (click)="loadDataHelpSidebarVisible=true"></p-button>


    </p-dialog>

    <p-dialog header="{{myReportHeader}}" [(visible)]="elevationVisible" [style]="{width: '80vw', height: '40vw'}">

        <p-chart type="line" [data]="elevationGridData" [options]="elevationGridOptions" height="100%" width="100%"></p-chart>

    </p-dialog>

    <p-dialog header="{{myReportHeader}} - Edit Inputs / outputs Data" [(visible)]="editDialogVisible" [style]="{width: '90vw', height: '95vw'}"  [modal]="true" [draggable]="true" [resizable]="true">
        <div class="card gap-2">
            <!-- <div class="card gap-2 border-500 border-1 border-round  col"> -->

                <p-fieldset legend="Manual Outflow (Change the remaining months)">
                    <div class="grid flex-shrink-0">
                        <div class="flex flex-shrink-0 col-4">
                            <div class="flex  flex-shrink-0 text-left  border-200 border-1 p-1 border-round font-bold">
                                <div class="flex-initial  flex-shrink-0 vertical-align-middle  p-5 border-round-sm font-bold">
                                    <p-radioButton 
                                        class=""
                                        name="outflowPercent" 
                                        value="Decrease" 
                                        [(ngModel)]="outflowDirection" 
                                        inputId="outflowPercent1"
                                        (onClick)="onPercentageChange(editMonthlyData)"/>
                                    <label for="outflowPercent1" class="font-bold">
                                        Decrease %
                                    </label>
                                    
                                    <p-radioButton 
                                    class=""
                                        name="outflowPercent" 
                                        value="Increase" 
                                        [(ngModel)]="outflowDirection" 
                                        inputId="outflowPercent2"
                                        (onClick)="onPercentageChange(editMonthlyData)"/>
                                    <label for="outflowPercent2" class="font-bold">
                                        Increase %
                                    </label>
                                </div>
                                <!-- <p-checkbox  (onChange)="compareFiles(myData)" [(ngModel)]="overRideChecked" [binary]="true"  inputId="binary" /> -->
                                <p-checkbox (onChange)="override(editMonthlyData)" [(ngModel)]="overRideChecked" [binary]="true"   label="Override" inputId="binary" />
                                <div class="flex-initial text-left   p-3 m-1 border-round-sm font-bold">
                                    <div class="col">
                                        <p-inputNumber [inputStyle]="{'text-align': 'right'}" class="p-inputtext-sm mb-3 w-0 font-bold" [maxFractionDigits]="4"  inputId="outflowPercentage" (onBlur)="onPercentageChange(editMonthlyData)"  mode="decimal" [size]="4" [min]="0" [max]="100"  [(ngModel)]="outflowPercetage" placeholder="Outflow %" suffix=" %"> </p-inputNumber>
                                        <p-slider [(ngModel)]="outflowPercetage" class="mb-3 w-0" (onChange)="onPercentageChange(editMonthlyData)" styleClass="w-30rem" />
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col">
                            
                            <div class="flex justify-content-end  p-1 border-round-sm ">
                                <div class="flex justify-content-end  p-5 border-round-sm ">
                                    <p-button id="refresh"      label="Clear Manual Inputs" icon="pi pi-refresh"     [style]="{'float':'right'}" [disabled]="operationMonthlyData.length === 0" [text]="true" [rounded]="true" severity="danger" [outlined]="true" (click)="clearManualEditInputs(editMonthlyData)"></p-button>
                                    <p-button id="help"         label="Help"               icon="pi pi-briefcase"      [style]="{'float':'right'}"                                   [text]="true" [rounded]="true" severity="info"   [outlined]="true" (click)="editHelpSidebarVisible=true"></p-button>
                                </div>
                            </div>
                        </div>
                    </div>
                </p-fieldset>
            
                <!-- <p-divider></p-divider>

                <div class="grid">
                    <div class="col-1">
                        <div class="flex align-items-center ml-3 mt-3 font-bold">
                            <label>Manual Outflow</label>
                        </div>
                    </div>
                </div>

                <div class="grid">
                    <div class="col-1 ml-1 mt-3">
                        <p-radioButton 
                            class="text-xs "
                            name="outflowPercent" 
                            value="Decrease" 
                            [(ngModel)]="outflowDirection" 
                            inputId="outflowPercent1"
                            (onClick)="onPercentageChange(editMonthlyData)"/>
                        <label for="outflowPercent1" class="ml-1 font-bold">
                            Decrease %
                        </label>
                    </div>
                    
                    <div class="col-1  ml-1 mt-3">
                        <p-radioButton 
                            class="text-xs"
                            name="outflowPercent" 
                            value="Increase" 
                            [(ngModel)]="outflowDirection" 
                            inputId="outflowPercent2"
                            (onClick)="onPercentageChange(editMonthlyData)"/>
                        <label for="outflowPercent2" class="ml-1 font-bold">
                            Increase %
                        </label>
                    </div>
                    
                    <div class="col-3 ml-1 mt-5">
                        <div class="flex align-items-center">
                            <p-slider [(ngModel)]="outflowPercetage" class="mb-3 w-0" (onChange)="onPercentageChange(editMonthlyData)" styleClass="w-30rem" />
                        </div>
                    </div>
                    
                    <div class="col-1 ml-1 mt-3">
                        <div class="flex align-items-center">
                            <p-inputNumber [inputStyle]="{'text-align': 'right'}" class="p-inputtext-sm mb-3 w-0 font-bold" [maxFractionDigits]="4"  inputId="outflowPercentage" (onBlur)="onPercentageChange($event)"  mode="decimal" [size]="4" [min]="0" [max]="100"  [(ngModel)]="outflowPercetage" placeholder="Outflow %"> </p-inputNumber>
                    
                        </div>
                    </div>
                    
                    <div class="col ml-5 mr-5">
                        <p-button id="refresh"      label="Clear Manual Inputs" icon="pi pi-refresh"     [style]="{'float':'right'}" [disabled]="operationMonthlyData.length === 0" [text]="true" [rounded]="true" severity="danger" [outlined]="true" (click)="clearManualEditInputs(editMonthlyData)"></p-button>
                        <p-button id="help"         label="Help"               icon="pi pi-briefcase"      [style]="{'float':'right'}"                                   [text]="true" [rounded]="true" severity="info"   [outlined]="true" (click)="editHelpSidebarVisible=true"></p-button>
                    </div>
                </div> -->
            <!-- </div> -->

            <p-divider></p-divider>

            <p-table [scrollable]="true" scrollHeight="600px" [styleClass]="selectedSize" [value]="editMonthlyData" [tableStyle]="{ 'min-width': '100rem' }" [autoLayout]="true">
                <ng-template pTemplate="header">
                    <tr padding="3px">
                        <th width="15px" class="text-center">Month</th>
                        <th width="5px"  class="text-center">Days</th>
                        <th width="10px"  class="text-center">Manual<br>Inflow<br>(AF)</th>
                        <th width="5px"  class="text-center">Predicted<br>Inflow<br>(AF)</th>
                        <th width="5px"  class="text-center">Manual<br>Outflow<br>(AF)</th>
                        <th width="5px"  class="text-center">Outflow<br>(AF)</th>
                        <th width="5px"  class="text-center">EOM<br>Content<br>(AF)</th>
                        <th width="5px"  class="text-center">EOM<br>Elevation<br>(FT)</th>
                        
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-myData >  
                       
                        <tr padding="3px">
                                                
                            <td width="15px" class="p-inputtext-sm">{{ myData.month + ' ' +  myData.dateRange }}</td>  
                            <td width="5px"  class="text-center"  >{{ myData.days}}</td>
                            <td width="8px"  class="text-center p-inputtext-sm"><p-inputNumber [inputStyle]="{'text-align': 'right'}" class="p-inputtext-sm" (onBlur)="recalculateEOM(editMonthlyData,myData.index)"               inputId="manualInflow_{{myData.index}}"         mode="decimal" [size]="6" [min]="0" [max]="106200"                         [(ngModel)]="myData.manualInflow"     placeholder="Inflow (AF)" [inputStyle]="{background:myData.manualInflowColor,'text-align': 'right'}"> </p-inputNumber></td>
                            <td width="5px" class="text-center p-inputtext-sm">{{myData.inflow}}</td>
                            <td width="5px"  class="text-center"><p-inputNumber [inputStyle]="{'text-align': 'right'}" class="p-inputtext-sm" (onBlur)="recalculateEOM(editMonthlyData,myData.index)"                   inputId="manualOutflow_{{myData.index}}"    mode="decimal" [size]="6" [min]="0" [max]="106200"                         [(ngModel)]="myData.manualOutflow"    placeholder="Outflow (AF)" [inputStyle]="{background:myData.manualOutFlowColor,'text-align': 'right'}"> </p-inputNumber></td>
                            <td width="5px" class="text-center p-inputtext-sm">{{myData.outflow}}</td>
                            <td width="5px" class="text-center p-inputtext-sm">{{myData.eomContent.toFixed(2)}}</td>
                            <td width="5px" class="text-center p-inputtext-sm"  [ngStyle]="{'background':myData.elevationWarning}" >{{myData.eomElevation.toFixed(2)}}</td>
                        </tr>
                    </ng-template>
            </p-table>

            <div class="grid">
                <div class="col ml-3 mt-3 mr-3">
                    <p-button  [style]="{'float':'left'}" (click)="saveOperationalEditData(editMonthlyData)" label="Incorporate Changes"></p-button>
                    <p-button  [style]="{'float':'right'}" (click)="closeEditDialog()" label="Cancel"></p-button>
                </div>
            </div>
        </div>
    </p-dialog>

    <p-dialog header="Clear Operational Data" [(visible)]="clearOperationDataVisible" [style]="{width: '20vw', height: '10vw'}"  [modal]="true" [draggable]="false" [resizable]="false">
        <!-- <div class="card flex justify-content-center gap-2"> -->
        <div class="card gap-2">
            <!-- <p-toast></p-toast>
            <p-confirmPopup></p-confirmPopup> -->
            <p-button  [style]="{'float':'left'}" (click)="clearOperationalData()" label="Clear Data"></p-button>
            <p-button  [style]="{'float':'right'}" (click)="closeClearOperationalDataDialog()" label="Cancel"></p-button>
        </div>
    </p-dialog>

    <p-dialog header="Calendar" class="flex-shrink-0 flex" [(visible)]="calendarVisible" [style]="{width: '24vw', height: '22vw'}">
        <div class="flex-shrink-0 align-items-center justify-content-center">
            <p-calendar class=" flex-shrink-0 flex align-items-center justify-content-center" [(ngModel)]="myDate"  [inline]="true" [showWeek]="true"></p-calendar>
        </div>

    </p-dialog>

    <p-dialog header="Links" [(visible)]="linksVisible" [style]="{width: '`100vw', height: '23vw'}">

        <p-table [scrollable]="true" scrollHeight="800px" [value]="myLinks" [tableStyle]="{ 'min-width': '60rem' }" [autoLayout]="true">
            {{errors.fataError}}
            <ng-template pTemplate="header">
                <tr padding="3px">
                    <th width="15px" class="text-left">Link</th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-myLink>
                <tr padding="3px">
                    <td><a href="{{myLink.link}}" target="_blank">{{myLink.name}}</a></td>
                </tr>
            </ng-template>
        </p-table>
        
        <p-button  [style]="{'float':'right'}" (click)="linksVisible = false" label="Close"></p-button>

    </p-dialog>

    <p-dialog header="Input Errors" [(visible)]="errorInputVisible" [style]="{width: '`100vw', height: '23vw'}">

        <p-table [scrollable]="true" scrollHeight="800px" [value]="errors.errors" [tableStyle]="{ 'min-width': '60rem' }" [autoLayout]="true">
            {{errors.fataError}}
            <ng-template pTemplate="header">
                <tr padding="3px">
                    <th width="15px" class="text-center">Line</th>
                    <th width="785px" class="text-left">Error</th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-myError>
                <tr padding="3px">
                    <td>{{myError.row}}</td>
                    <td>{{myError.error}}</td>
                </tr>
            </ng-template>
        </p-table>
        
        <p-button  [style]="{'float':'right'}" (click)="closeErrorInputDialog()" label="Close"></p-button>

    </p-dialog>

    <p-dialog header="Save Data" [(visible)]="saveDialogVisible" [style]="{width: '23vw', height: '17vw'}">

        <p-divider></p-divider>

        <div class="p-field">
            <span class="p-float-label">
                <input pInputText id="filename" [style]="{width: '20vw'}" (keyup)="checkNameCharacter(fileName)"  [(ngModel)]="fileName" />
                <label for="filename">File Name</label>
            </span>
        </div>
        <span>
            <small id="filename-help">
                Only Alphnumeric chnaraters and a - (dash) are valid.  Dashes can not be the first or last character of the name.
            </small>
        </span>

        <p-divider></p-divider>
        
        <p-button  [style]="{'float':'left'}" (click)="saveOperationalData()" label="Save Data"></p-button>
        <p-button  [style]="{'float':'right'}" (click)="saveDialogVisible = !saveDialogVisible" label="Cancel"></p-button>
        <p-button id="help"         label="Help"              icon="pi pi-briefcase"      [style]="{'float':'right'}"                                   [text]="true" [rounded]="true" severity="info"   [outlined]="true" (click)="saveDataHelpSidebarVisible=true"></p-button>

    </p-dialog>
    <p-dialog header="Import Saved Report" [(visible)]="importFileDialogVisible" [style]="{width: '23vw', height: '17vw'}">

        <p-fileUpload 
        mode="basic" 
        chooseLabel="Upload Saved Report" 
        chooseIcon="pi pi-upload"
        name="demo[]" 
        url="https://www.primefaces.org/cdn/api/upload.php" 
        accept="text/*" 
        [auto]="true" 
        [maxFileSize]="100000"
        (onUpload)="readOperationalData($event)" />
        <p-button id="help"         label="Help"              icon="pi pi-briefcase"      [style]="{'float':'right'}"                                   [text]="true" [rounded]="true" severity="info"   [outlined]="true" (click)="fileImportHelpSidebarVisible=true"></p-button>

    </p-dialog>
</p-panel>  

<p-toast position="top-center" key="message"></p-toast>

